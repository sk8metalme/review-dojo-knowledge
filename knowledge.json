{
  "knowledge_items": [
    {
      "category": "design",
      "language": "github-actions",
      "severity": "warning",
      "title": "GitHub Actions: peter-evans/repository-dispatch v4 アップグレード時のランナーバージョン要件",
      "summary": "peter-evans/repository-dispatch@v4 にアップグレードする際、self-hosted ランナーを使用している場合は Actions Runner v2.327.1 以上が必須（Node 24 サポート対応）。GitHub ホストランナーの場合は影響なし。",
      "recommendation": "self-hosted ランナーを使用する場合は Actions Runner v2.327.1 以上にアップグレードすること。コア入力（token、repository、event-type、client-payload）に変更はないため、その他の互換性問題はない。",
      "code_example": {
        "bad": "# v2 から v4 にアップグレード時、self-hosted ランナーのバージョンを確認していない\nuses: peter-evans/repository-dispatch@v4",
        "good": "# v4 にアップグレード前に self-hosted ランナーを v2.327.1+ に更新\n# または GitHub ホストランナーを使用\nuses: peter-evans/repository-dispatch@v4\n# runs-on: ubuntu-latest # GitHub ホストランナーの場合は問題なし"
      },
      "file_path": ".github/workflows/trigger-knowledge-collection.yml",
      "pr_url": "https://github.com/sk8metalme/review-dojo-knowledge/pull/3",
      "original_comment": "peter-evans/repository-dispatch@v4 へのアップグレードを確認してください。\n\nv4 アップグレードは適切ですが、以下のブレーキングチェンジに対応が必要です：\n\n- **self-hosted ランナー利用時**: Actions Runner v2.327.1 以上が必須です (Node 24 サポート対応)。このワークフローが self-hosted ランナーで実行される場合は、ランナーのバージョンアップを確認してください。\n- コア入力（token、repository、event-type、client-payload）に変更はありませんので、その他の互換性への影響はありません。\n\nGitHub ホストランナーの場合はこのアップグレードは安全です。"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "info",
      "title": "Markdownドキュメントでコードブロックに言語指定を追加",
      "summary": "フェンスコードブロック（```）に言語指定がないとシンタックスハイライトが適用されず、可読性が低下する。markdownlint MD040ルール違反。",
      "recommendation": "すべてのコードブロックに適切な言語識別子（bash, json, text, plaintext等）を指定する。",
      "code_example": {
        "bad": "```\nnpm run lint\nnpm run test\n```",
        "good": "```bash\nnpm run lint\nnpm run test\n```"
      },
      "file_path": "CLAUDE.md",
      "pr_url": "https://github.com/sk8metalme/nodejs-study/pull/8",
      "original_comment": "markdownlint（MD040）によると、フェンスコードブロックに言語仕様が指定されていません。コマンド例の場合は`bash`を追加しください。"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "info",
      "title": "Markdownで強調の代わりに見出し構造を使用",
      "summary": "太字強調（**text**）を見出しの代わりに使用すると、文書構造が不明確になり、アクセシビリティツールが正しく解釈できない。markdownlint MD036ルール違反。",
      "recommendation": "セクションタイトルには強調ではなく適切な見出しレベル（###等）を使用する。",
      "code_example": {
        "bad": "**注意: 手動公開は非推奨（CI経由を推奨）**",
        "good": "### 注意\n\n手動公開は非推奨です。CI経由の公開を推奨します。"
      },
      "file_path": "CLAUDE.md",
      "pr_url": "https://github.com/sk8metalme/nodejs-study/pull/8",
      "original_comment": "「注意」セクションは、強調（`**...**`）ではなく見出し（`###`）で表現すると、ドキュメント構造がより明確になります。markdownlint（MD036）の推奨に従ってください。"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "info",
      "title": "マークダウン：強調記号の代わりにヘッディングを使用",
      "summary": "ドキュメント構造を改善するため、強調記号 (**...**) の代わりにマークダウンヘッディング (###) を使用する",
      "recommendation": "セクションタイトルには強調記号ではなく適切なレベルのマークダウンヘッディングを使用し、目次生成やアウトライン表示を可能にする",
      "code_example": {
        "bad": "**計画フェーズ（SDD: 仕様駆動開発）**",
        "good": "### 計画フェーズ（SDD: 仕様駆動開発）"
      },
      "file_path": ".claude/CLAUDE.md",
      "pr_url": "https://github.com/sk8metalme/ai-agent-setup/pull/1",
      "original_comment": "MD036規則により、強調記号 `**...**` の代わりに、マークダウンヘッディング (`###`) を使用してください。これにより、ドキュメント構造が改善され、目次生成やアウトライン表示が可能になります。"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "info",
      "title": "Markdownリンクフラグメントは見出しと一致させる",
      "summary": "README内の内部リンクのフラグメント識別子が実際の見出しと一致していなかった。markdownlint MD051ルール違反。",
      "recommendation": "内部リンクのフラグメントは、実際の見出しのslugと完全に一致させる必要があります。見出しに番号プレフィックス（例: '1.'）がある場合、フラグメントにも含める必要があります",
      "code_example": {
        "bad": "[グローバル設定](#-グローバル設定のインストール)\n// 実際の見出し: ### 1. グローバル設定のインストール",
        "good": "[グローバル設定](#1-グローバル設定のインストール)\n// 実際の見出し: ### 1. グローバル設定のインストール"
      },
      "file_path": "README.md",
      "pr_url": "https://github.com/sk8metalme/ai-agent-setup/pull/35",
      "original_comment": "Line 9のリンク`#-グローバル設定のインストール`は、Line 169の実際の見出し`### 1. グローバル設定のインストール`と一致しません。番号プレフィックスが欠落しています。"
    },
    {
      "category": "design",
      "language": "markdown",
      "severity": "warning",
      "title": "Claude Code plugin.json仕様の命名規則とキー不足の修正",
      "summary": "plugin.jsonのサポートキー表が公式Claude仕様と不一致。`skills`を`commands`に修正が必要。`mcpServers`はキャメルケース表記にすべき。また`homepage`、`category`、`tags`、`strict`などのサポート済みキーが表から漏落している。",
      "recommendation": "公式仕様に従い、以下を修正：1) `skills`→`commands`（コマンドマークダウンファイルへのパスまたはパス配列）、2) `mcp_servers`→`mcpServers`（キャメルケース）、3) 漏落キーの追加：`homepage`（ドキュメント/プロジェクトURL）、`category`/`tags`（マーケットプレイス検索フィールド）、`strict`（マニフェスト検証の強制設定フラグ）",
      "code_example": {
        "bad": "| skills | スキル定義 | いいえ |\n| mcp_servers | MCPサーバー設定 | いいえ |",
        "good": "| commands | コマンドマークダウンファイルへのパスまたはパス配列 | いいえ |\n| mcpServers | MCPサーバー設定（キャメルケース） | いいえ |\n| homepage | ドキュメント/プロジェクトURL | いいえ |\n| category | マーケットプレイスカテゴリ | いいえ |\n| tags | 検索タグ配列 | いいえ |\n| strict | マニフェスト検証強制フラグ | いいえ |"
      },
      "file_path": "CLAUDE.md",
      "pr_url": "https://github.com/sk8metalme/dotfiles/pull/20",
      "original_comment": "プラグイン定義表の複数の不足および命名一貫性の問題を修正してください。\n\n公式のClaudeプラグイン仕様と比較すると、サポートキー表に以下の問題があります：\n\n- `skills`は`commands`に修正する必要があります（コマンドファイルへのパスまたはパス配列を指定）\n- 以下のサポート済みキーが表から漏落しています：`homepage`（ドキュメント/プロジェクトURL）、`category`/`tags`（マーケットプレイス検索フィールド）、`strict`（マニフェスト検証の強制設定）、`commands`（コマンドマークダウンファイルパス配列）\n- `mcp_servers`は公式仕様では`mcpServers`（キャメルケース）と記載されています\n\n表を公式仕様に完全に合わせることで、開発者の参考価値が向上します。"
    },
    {
      "category": "design",
      "language": "markdown",
      "severity": "warning",
      "title": "無効なコマンド参照を避ける",
      "summary": "ドキュメント内で存在しないコマンドを参照しており、ユーザーが実行できない指示を提供している",
      "recommendation": "ドキュメント内でコマンドを参照する際は、そのコマンドが実際に存在することを確認する。存在しない場合は、代替コマンドに置き換えるか、該当ステップを削除する。外部プラグインが必要な場合は、前提条件として明記する",
      "code_example": {
        "bad": "/kiro:validate-gap $1",
        "good": "/michi:validate-design $1 または該当ステップを削除"
      },
      "file_path": "plugins/michi/commands/michi/spec-requirements.md",
      "pr_url": "https://github.com/sk8metalme/michi/pull/169",
      "original_comment": "Line 72 の `/kiro:validate-gap $1` は存在しないコマンドです。このリポジトリに kiro プラグインがなく、michi プラグインにも `/michi:validate-gap` がありません。ユーザーが実行できない指示を提供することになるため、以下のいずれかで対応してください：\n\n- このステップを削除する\n- 実在するコマンド（例：`/michi:validate-design $1`）に置き換える\n- kiro との連携が必須の場合は、前提条件を明確に記載する"
    },
    {
      "category": "error-handling",
      "language": "bash",
      "severity": "warning",
      "title": "JSONパース処理の脆弱性 - grep/sedの限界",
      "summary": "grep/sedを使用したJSON解析は、エスケープされた引用符、改行を含む値、Unicodeエスケープシーケンスを正しく処理できず、パターンマッチが失敗する可能性がある",
      "recommendation": "jqを使用した堅牢なJSON解析に置き換え、jqが利用できない環境向けにフォールバックロジックを追加する",
      "code_example": {
        "bad": "file_path=$(echo \"$tool_input\" | grep -oE '\"file_path\"\\s*:\\s*\"[^\"]*\"' | sed 's/\"file_path\"\\s*:\\s*\"\\([^\"]*\\)\"/\\1/' || echo \"\")",
        "good": "if command -v jq &>/dev/null; then\n    file_path=$(echo \"$tool_input\" | jq -r '.file_path // empty' 2>/dev/null || echo \"\")\nelse\n    file_path=$(echo \"$tool_input\" | grep -oE '\"file_path\"\\s*:\\s*\"[^\"]*\"' | sed 's/\"file_path\"\\s*:\\s*\"\\([^\"]*\\)\"/\\1/' || echo \"\")\nfi"
      },
      "file_path": "global/hooks/protect-secrets.sh",
      "pr_url": "https://github.com/sk8metalme/ai-agent-setup/pull/38",
      "original_comment": "_⚠️ Potential issue_ | _🟠 Major_\n\n**JSONパースがフラジャイル（脆弱）**\n\n`grep`と`sed`を使用したJSON解析は、エスケープされた引用符、改行を含む値、Unicodeエスケープシーケンスを正しく処理できません。Claude Codeの入力にこれらが含まれる場合、パターンマッチが失敗する可能性があります。"
    },
    {
      "category": "readability",
      "language": "bash",
      "severity": "info",
      "title": "正規表現パターンの末尾スペースによるマッチング問題",
      "summary": "コマンドパターンの末尾にスペースがあることで、パイプを使用したコマンドや引数のないコマンドが正しくマッチしない",
      "recommendation": "パターン文字列から末尾スペースを削除し、単語境界（\\b）または明示的な区切り文字（パイプ、セミコロン等）を使用した正規表現に変更する",
      "code_example": {
        "bad": "read_commands=\"cat |less |more |head |tail |vim |nano |vi |emacs |grep |awk |sed \"\nfor cmd in $read_commands; do\n    if echo \"$bash_command\" | grep -qE \"^${cmd}| ${cmd}\"; then",
        "good": "read_commands=\"cat|less|more|head|tail|vim|nano|vi|emacs|grep|awk|sed\"\nfor cmd in ${read_commands//|/ }; do\n    if echo \"$bash_command\" | grep -qE \"(^|[|;&])\\\\s*${cmd}\\\\b\"; then"
      },
      "file_path": "global/hooks/protect-secrets.sh",
      "pr_url": "https://github.com/sk8metalme/ai-agent-setup/pull/38",
      "original_comment": "_⚠️ Potential issue_ | _🟡 Minor_\n\n**read_commandsパターンの末尾スペースに注意**\n\n各コマンドパターンの末尾にスペースがあります（例：`\"cat \"`）。これにより、パイプを使用したコマンド（`cat file | grep`）や引数のないコマンド（行末の`cat`）が正しくマッチしない可能性があります。"
    },
    {
      "category": "other",
      "language": "bash",
      "severity": "info",
      "title": "statコマンドのプラットフォーム互換性問題",
      "summary": "statコマンドの出力形式がmacOS（BSD）とLinux（GNU）で異なるため、パーミッション確認ロジックが正確に機能しない。macOSは\"40700\"（ファイルタイプ含む）、Linuxは\"700\"（パーミッションのみ）を返す",
      "recommendation": "stat出力の最後の3桁のみを抽出して比較することで、プラットフォーム間の互換性を確保する",
      "code_example": {
        "bad": "if [[ $(stat -f \"%p\" \"$HOME/.secrets\" 2>/dev/null || stat -c \"%a\" \"$HOME/.secrets\" 2>/dev/null) != *700 ]]; then\n    chmod 700 \"$HOME/.secrets\"",
        "good": "local current_perm=$(stat -f \"%p\" \"$HOME/.secrets\" 2>/dev/null || stat -c \"%a\" \"$HOME/.secrets\" 2>/dev/null)\nif [[ \"${current_perm: -3}\" != \"700\" ]]; then\n    chmod 700 \"$HOME/.secrets\"\n    echo \"✓ Fixed ~/.secrets/ permission to 700\"\nfi"
      },
      "file_path": "install-global.sh",
      "pr_url": "https://github.com/sk8metalme/ai-agent-setup/pull/38",
      "original_comment": "_⚠️ Potential issue_ | _🟡 Minor_\n\n**パーミッション確認ロジックにプラットフォーム互換性の問題があります。**\n\nLine 179の `stat` コマンドによるパーミッション確認が、macOS（BSD）とLinux（GNU）で異なる出力形式のため、正確に機能しません"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "critical",
      "title": "ドキュメントリンクの検証を必須化",
      "summary": "マイグレーション後のドキュメント内で、存在しないファイルへのリンクが複数発見された。.michi/steering/構造への参照が壊れており、ユーザーがドキュメントを参照できない状態となっている。",
      "recommendation": "PRレビュー時にドキュメントリンクの自動検証を実装する。マイグレーションやリネーム作業後は、必ずリンク切れチェックを実行すること。CI/CDパイプラインにマークダウンリンク検証ツールを組み込むことを推奨。",
      "code_example": {
        "bad": "# マイグレーション後の参照\n- [構造ガイド](.michi/steering/structure.md)\n- [ワークフロー](.michi/steering/workflow.md)\n\n// 実際のファイル位置が変更されているがリンクは更新されていない",
        "good": "# マイグレーション後の検証付き参照\n- [ワークフロー](./docs/guides/workflow.md)\n\n# CI/CDでの検証例\n# .github/workflows/docs-check.yml\n- name: Check markdown links\n  run: |\n    npm install -g markdown-link-check\n    find . -name '*.md' -exec markdown-link-check {} \\;"
      },
      "file_path": "docs/MIGRATION.md",
      "pr_url": "https://github.com/sk8metalme/michi/pull/166",
      "original_comment": "`.michi/steering/`に参照されているドキュメントファイルが存在しません。修正が必要です。行503-504のドキュメント参照パスが壊れています：- `.michi/steering/`ディレクトリが存在しない- `structure.md`がリポジトリ内に見つからない- `workflow.md`は`./docs/guides/workflow.md`に存在するが、参照パスが間違っている"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "warning",
      "title": "マイグレーション後の用語統一",
      "summary": "Kiroからmichiへのマイグレーション後、ドキュメント内のラベルやコマンド参照が古い名称のまま残っている。特にユーザー向けメッセージやエラー文で不整合が発生している。",
      "recommendation": "マイグレーション作業では、コードだけでなくドキュメント、エラーメッセージ、ログ出力も含めた全体的な用語の置換を実施すること。検索・置換の自動化スクリプトを用意し、手動での見落としを防ぐ。",
      "code_example": {
        "bad": "# ドキュメント内のラベル\nKiro directory: {{SPEC_DIR}}  # 値は.michiを指しているのにラベルはKiro\n\n# エラーメッセージ\nconsole.log('先に/kiro:spec-requirements を実行してください');  # 新しいコマンドは/michi:*",
        "good": "# 統一された用語\nSpec directory: {{SPEC_DIR}}  # またはMichi directory\n\n# 更新されたエラーメッセージ\nconsole.log('先に/michi:spec-requirements を実行してください');\n\n# マイグレーションスクリプト例\n#!/bin/bash\nfind . -type f \\( -name '*.md' -o -name '*.ts' \\) -exec sed -i 's|/kiro:|/michi:|g' {} \\;\nfind . -type f -name '*.md' -exec sed -i 's|Kiro directory|Spec directory|g' {} \\;"
      },
      "file_path": "plugins/michi/commands/michi/confluence-sync.md",
      "pr_url": "https://github.com/sk8metalme/michi/pull/166",
      "original_comment": "コマンドドキュメントのラベルを更新してください。行43のラベルは「Kiro directory:」のままですが、値は{{SPEC_DIR}}（.michi directory）を参照しています。ラベルとの整合性を取るため、「Spec directory:」または「Michi directory:」に更新してください。"
    },
    {
      "category": "readability",
      "language": "markdown",
      "severity": "critical",
      "title": ".michiディレクトリの不在によるリンク切れ",
      "summary": "scripts/README.mdで.michiディレクトリ配下のファイルを参照しているが、リポジトリに.michiディレクトリそのものが存在しない。全てのリンクが404となっている。",
      "recommendation": "ドキュメント構造とファイルシステム構造を一致させること。存在しないディレクトリへの参照は絶対に避ける。新規ディレクトリや構造変更を伴う場合は、ファイル作成とドキュメント更新を同一PRで実施すべき。",
      "code_example": {
        "bad": "# 存在しないディレクトリへの参照\n- [設計ドキュメント](../.michi/specs/onion-architecture/design.md)\n- [構造ガイド](../.michi/steering/structure.md)\n- [ワークフローガイド](../.michi/steering/workflow.md)\n\n// .michiディレクトリが存在しないため全てリンク切れ",
        "good": "# アプローチ1: ディレクトリとファイルを作成\nmkdir -p .michi/specs/onion-architecture\nmkdir -p .michi/steering\n# 必要なドキュメントを配置\n\n# アプローチ2: 既存ドキュメントへ修正\n- [設計ドキュメント](./docs/architecture.md)\n- [ワークフローガイド](./docs/guides/workflow.md)\n\n# PRレビューでのチェック項目\n# - 新規リンクの追加時は対象ファイルの存在確認\n# - CI/CDでリンク検証を自動実行"
      },
      "file_path": "scripts/README.md",
      "pr_url": "https://github.com/sk8metalme/michi/pull/166",
      "original_comment": "破損したドキュメントリンクを修正してください。参照先ファイルが存在しません。`.michi` ディレクトリ自体がリポジトリに存在せず、以下のすべてのドキュメントリンクが破損しています：- `../.michi/specs/onion-architecture/design.md`- `../.michi/steering/structure.md`- `../.michi/steering/workflow.md`"
    }
  ],
  "skipped_comments": [
    {
      "reason": "コードブロック言語指定のみの重複指摘（76行目）",
      "comment_preview": "Markdownlint-cli2により70以上の箇所でMD040エラーが報告されています..."
    },
    {
      "reason": "コードブロック言語指定のみの重複指摘（115行目）",
      "comment_preview": "ディレクトリツリーの表示は`tree`形式またはプレーンテキストですが..."
    },
    {
      "reason": "コードブロック言語指定のみの重複指摘（149行目）",
      "comment_preview": "markdownlint（MD040）に対応するため、ツリー構造表示にも言語指定を追加してください..."
    },
    {
      "reason": "コードブロック言語指定のみの重複指摘（158行目）",
      "comment_preview": "markdownlint（MD040）に対応するため、ツリー構造表示にも言語指定を追加してください..."
    },
    {
      "reason": "コードブロック言語指定のみの重複指摘（174行目）",
      "comment_preview": "markdownlint（MD040）に対応するため、ツリー構造表示にも言語指定を追加してください..."
    },
    {
      "reason": "コードブロック言語指定のみの重複指摘（193行目）",
      "comment_preview": "markdownlint（MD040）に対応するため、依存方向図を示すコードブロックに言語指定を追加してください..."
    },
    {
      "reason": "未解決のレビュースレッド",
      "comment_preview": "マークダウン: ベアURLをリンク形式に変更してください..."
    },
    {
      "reason": "未解決のレビュースレッド",
      "comment_preview": "マークダウン形式: コード言語指定とベアURL の修正が必要です..."
    },
    {
      "reason": "未解決のレビュースレッド",
      "comment_preview": "cc-sdd インストール手順が欠落しており、ワークフロー内の /kiro: コマンドが未定義です..."
    },
    {
      "reason": "未解決のレビュースレッド（isResolved = false）",
      "comment_preview": "既存のhooks設定が上書きされる可能性があります - Line 101の`jq`マージ処理（`.[0] * .[1]`）は浅いマージであり、既存の`hooks`設定全体を新しい設定で置き換えます..."
    },
    {
      "reason": "未解決のレビュースレッド（isResolved = false）",
      "comment_preview": "ハードコードされた設定値は使用されていません - projectId: 'default'、projectName: 'Default Project'、jiraKey: 'PROJ' のハードコード値は、このコード経路では実際に使用されず..."
    },
    {
      "reason": "未解決のレビュースレッド（isResolved = false）",
      "comment_preview": "`~/.michi/` パスのファイル名が無視されるバグ - `~/.michi/custom.env` のようなカスタムファイル名を渡しても、常に `~/.michi/.env` が返されます..."
    },
    {
      "reason": "未解決スレッド（isResolved=false）- PR #166",
      "comment_preview": "ベースコマンドパスを michi に更新してください。`@.claude/commands/kiro/spec-status.md` は `@.claude/commands/michi/spec-status.md` に更新が必要です。"
    },
    {
      "reason": "未解決スレッド（isResolved=false）- PR #166",
      "comment_preview": "ベースコマンドファイルが存在しません。`plugins/michi/commands/michi/validate-gap.md` 内で参照されている `.claude/commands/kiro/validate-gap.md` が見つかりません。"
    },
    {
      "reason": "未解決スレッド（isResolved=false）- PR #166",
      "comment_preview": "ドキュメント化されたコマンドの実装状況を明記してください。3つのコマンド（`/michi:generate-tests`、`/michi:fix-security`、`/michi:optimize`）がドキュメントに記載されていますが、コードベース内に実装がありません。"
    },
    {
      "reason": "未解決スレッド（isResolved=false）- PR #166",
      "comment_preview": "パス更新は完了していますが、コマンド参照に不整合があります。ファイルシステムパスは `.kiro` から `.michi` へ正しく更新されていますが、エラーメッセージ内のコマンド参照が古いままです。"
    }
  ]
}
